(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3c00f94f"],{"0a49":function(e,t,n){var i=n("9b43"),r=n("626a"),a=n("4bf8"),s=n("9def"),c=n("cd1c");e.exports=function(e,t){var n=1==e,o=2==e,u=3==e,l=4==e,h=6==e,m=5==e||h,p=t||c;return function(t,c,d){for(var f,v,y=a(t),T=r(y),g=i(c,d,3),b=s(T.length),w=0,P=n?p(t,b):o?p(t,0):void 0;b>w;w++)if((m||w in T)&&(f=T[w],v=g(f,w,y),e))if(n)P[w]=v;else if(v)switch(e){case 3:return!0;case 5:return f;case 6:return w;case 2:P.push(f)}else if(l)return!1;return h?-1:u||l?l:P}}},1169:function(e,t,n){var i=n("2d95");e.exports=Array.isArray||function(e){return"Array"==i(e)}},3724:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"player-wrap"},[e.loading?n("div",{staticClass:"player-loading"},[e._v("视频加载中...")]):e._e(),e._v(" "),e.rtcStream?[e.controls?[n("video",{attrs:{autoplay:"",controls:"",controlslist:"nodownload nofullscreen noremoteplayback",disablePictureInPicture:""},domProps:{srcObject:e.rtcStream}})]:[n("video",{attrs:{autoplay:""},domProps:{srcObject:e.rtcStream}})]]:e._e()],2)},r=[],a=(n("96cf"),n("3b8d")),s=n("4ec3"),c={name:"WebrtcPlayer",rtcPeerConnection:null,data:function(){return{iceConnectionState:"",rtcPeerConnectionInit:!1,rtcStream:null,loading:!0}},props:{streamPath:{type:String,default:""},controls:{type:Boolean,default:!0}},created:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.initRtcPeerConnection();case 2:if(console.log("initRtcPeerConnectioned"),!this.streamPath){e.next=10;break}return this.loading=!0,e.next=7,this.play(this.streamPath);case 7:this.loading=!1,console.log("played"),this.$emit("doPlayed");case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{initRtcPeerConnection:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,n,i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=new RTCPeerConnection,t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"}),t.onsignalingstatechange=function(e){console.log("onsignalingstatechange",e)},t.oniceconnectionstatechange=function(e){console.log("oniceconnectionstatechange",t.iceConnectionState)},t.onicecandidate=function(e){console.log("onicecandidate",e)},t.ontrack=function(e){console.log("ontrack",e),"video"===e.track.kind&&(i.rtcStream=e.streams[0])},e.next=9,t.createOffer();case 9:return n=e.sent,e.next=12,t.setLocalDescription(n);case 12:this.rtcPeerConnectionInit=!0,this.$options.rtcPeerConnection=t;case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),play:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n,i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=this.$options.rtcPeerConnection,i=n.localDescription.toJSON(),e.next=4,Object(s["j"])(t,i);case 4:if(r=e.sent,!r.error){e.next=7;break}return e.abrupt("return");case 7:n.setRemoteDescription(new RTCSessionDescription({type:r.type,sdp:r.sdp}));case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),close:function(){var e=this.$options.rtcPeerConnection;e&&e.close()}},destroyed:function(){this.close()}},o=c,u=n("2877"),l=Object(u["a"])(o,i,r,!1,null,"d0275eb4",null);t["a"]=l.exports},7514:function(e,t,n){"use strict";var i=n("5ca1"),r=n("0a49")(5),a="find",s=!0;a in[]&&Array(1)[a]((function(){s=!1})),i(i.P+i.F*s,"Array",{find:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")(a)},cd1c:function(e,t,n){var i=n("e853");e.exports=function(e,t){return new(i(e))(t)}},d2cd:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"record-wrap"},[n("div",{staticClass:"record-player"},[n("div",{staticClass:"record-time-select"},[n("el-date-picker",{staticStyle:{width:"200px"},attrs:{type:"date",size:"small",clearable:!1,"value-format":"timestamp","picker-options":e.pickerOptions,placeholder:"选择日期"},on:{change:e.onSearchTimeChange},model:{value:e.searchTime,callback:function(t){e.searchTime=t},expression:"searchTime"}})],1),e._v(" "),e.recordList.length>0?[e.recordSP?n("webrtc-player",{key:e.recordSP,attrs:{controls:!1,"stream-path":e.recordSP},on:{doPlayed:e.handlePlayed}}):n("p",{staticStyle:{"text-align":"center"}},[e._v("\n          初始化...\n        ")])]:e._e()],2),e._v(" "),n("div",{staticClass:"record-time"},[n("div",{ref:"timeDay",staticClass:"time-day"},[e._l(e.minuteList,(function(t){return n("div",{staticClass:"time-minute",class:{active:t.hasRecord},attrs:{title:t.title},on:{click:function(n){return e.onMinuteClick(t)}}})})),e._v(" "),e._l(e.hourList,(function(t){return n("div",{staticClass:"time-text"},[e._v("\n          "+e._s(t.title)+"\n        ")])}))],2),e._v(" "),e.playTime.now?n("div",{staticClass:"time-cursor",style:e.playTimeStyle,on:{mousedown:e.onStartMove,mousemove:e.onDoingMove,mouseup:e.onStopMove}},[n("div",{staticClass:"time-cursor-text"},[e.isPlayTimeMoving?[e._v("\n            "+e._s(e.playMoveTime)+"\n          ")]:[e._v("\n            "+e._s(e._f("parseTimeFilter")(e.playTime.now,"{h}:{i}:{s}"))+"\n          ")]],2)]):e._e()])])},r=[],a=(n("8e6e"),n("456d"),n("6b54"),n("96cf"),n("3b8d")),s=(n("7514"),n("ac6a"),n("bd86")),c=n("ed08"),o=n("3724"),u=n("2f62"),l=n("4ec3");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=(new Date).getTime();function d(){for(var e=[],t=1;t<1440;t++)e.push({title:Object(c["b"])(t),timestamp:t,endTimestamp:"",hasRecord:!1});return e}function f(){for(var e=[],t=0;t<24;t++){var n=t+":00";n<10&&(n="0"+n),e.push({title:n,timestamp:t+1})}return e}var v={name:"Record",props:{recordSearch:{type:Object,default:function(){return{}}}},data:function(){return{hasInitMinute:!1,hasQuery:!1,searchTime:p,minuteList:d(),hourList:f(),playTime:{start:"",end:"",now:""},isPlaying:!1,pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()}},recordSP:null,isPlayTimeMoving:!1,playTimeOffset:0}},created:function(){this.init()},timeInterval:null,components:{WebrtcPlayer:o["a"]},watch:{recordList:function(){!this.hasInitMinute&&this.hasQuery&&(this.hasInitMinute=!0,this.updateMinuteList())},channel:{handler:function(e,t){e&&e.RecordSP&&(this.recordSP=e.RecordSP)},immediate:!0}},computed:m(m({},Object(u["b"])({gb28181List:function(e){return e.Gb28181List},gb28181ChannelList:function(e){var t=[];return e.Gb28181List.forEach((function(e){var n=e.Channels||[];n.length>0&&(t=t.concat(n.map((function(t){return t.id=e.ID,t.deviceId=t.DeviceID,t}))))})),t}})),{},{channel:function(){var e=this;return this.gb28181ChannelList.find((function(t){return t.id===e.recordSearch.id&&t.deviceId===e.recordSearch.deviceId}))},recordList:function(){var e=this,t=[],n=this.gb28181ChannelList.find((function(t){return t.deviceId===e.recordSearch.deviceId&&t.id===e.recordSearch.id}));if(n){var i=n.Records||[];t=i.map((function(e){var t=new Date(e.StartTime).getTime(),n=new Date(e.EndTime).getTime(),i=n-t,r=Object(c["h"])(t),a=Object(c["h"])(n);return e._startTime=t/1e3>>0,e._endTime=n/1e3>>0,e.timeLength=Math.floor(i/1e3/60%60),e.startTime=r,e.endTime=a,e.startTimestamp=t,e.endTimestamp=n,e}))}return t},playTimeStyle:function(){var e=0;if(this.isPlayTimeMoving)e=this.playTimeOffset;else if(this.playTime.now){var t=new Date(this.playTime.now),n=t.getHours(),i=t.getMinutes();e=60*n+i}var r={left:e+"px"};return r},playMoveTime:function(){return Object(c["b"])(this.playTimeOffset)}}),methods:{init:function(){this.fetchList()},fetchList:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.getSearchTimeRange(),n={id:this.recordSearch.id,channel:this.recordSearch.channel,startTime:t.start,endTime:t.end},e.next=4,Object(l["n"])(n);case 4:this.hasQuery=!0;case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getSearchTimeRange:function(){var e=Object(c["f"])(this.searchTime),t=e.start,n=e.end,i=new Date(t).toISOString(),r=new Date(n).toISOString();return{start:i,end:r}},onSearchTimeChange:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.minuteList=d(),e.next=3,this.stop();case 3:this.init();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),updateMinuteList:function(){var e=this;this.playTime.start="",this.playTime.now="",this.playTime.endTime="",this.minuteList.forEach((function(t){var n=e.formatMinuteItemTimestamp(t);e.recordList.forEach((function(i){i.startTimestamp<=n&&i.endTimestamp>n&&(t.hasRecord=!0,t.endTimestamp=i.endTimestamp,e.playTime.start||(e.playTime.start=i.startTimestamp,e.playTime.end=i.endTimestamp))}))})),this.playTime.start&&this.play()},formatMinuteItemTimestamp:function(e){var t=Math.floor(e.timestamp/60)%60,n=Math.floor(e.timestamp%60),i=new Date(this.searchTime).setHours(t,n,0,0);return i},onStartMove:function(e){this.isPlayTimeMoving=!0,this.updatePlayTimeOffset(e)},onDoingMove:function(e){this.isPlayTimeMoving&&this.updatePlayTimeOffset(e)},onStopMove:function(e){if(this.isPlayTimeMoving){var t=this.minuteList[this.playTimeOffset];t&&this.onMinuteClick(t),this.isPlayTimeMoving=!1,this.playTimeOffset=0}},updatePlayTimeOffset:function(e){var t=this.getTimeRect(),n=e.clientX-t.left;this.playTimeOffset=parseInt(n,10)},getTimeRect:function(){var e=this.$refs.timeDay;return e.getBoundingClientRect()},onMinuteClick:function(e){if(e.hasRecord){var t=this.formatMinuteItemTimestamp(e);this.playTime.start=t,this.playTime.end=e.endTimestamp,this.play()}},play:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.stop();case 2:return t={id:this.recordSearch.id,channel:this.recordSearch.channel,startTime:this.playTime.start/1e3>>0,endTime:this.playTime.end/1e3>>0},e.prev=3,e.next=6,Object(l["l"])(t);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](3),console.error(e.t0);case 11:this.playTime.now=this.playTime.start;case 12:case"end":return e.stop()}}),e,this,[[3,8]])})));function t(){return e.apply(this,arguments)}return t}(),handlePlayed:function(){this.intervalPlayTime()},stop:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.clearInterval(),this.isPlaying=!1,!this.recordSP){e.next=4;break}return e.abrupt("return",Object(l["r"])(this.recordSP));case 4:return e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),intervalPlayTime:function(){var e=this;this.isPlaying=!0,this.$options.timeInterval=setInterval((function(){e.playTime.now+=1e3,e.checkPlayNext()}),1e3)},checkPlayNext:function(){var e=this;if(this.playTime.now===this.playTime.end){var t=this.minuteList.find((function(t){var n=e.formatMinuteItemTimestamp(t);return t.hasRecord&&e.playTime.end<=n}));t&&(this.playTime.start=this.formatMinuteItemTimestamp(t),this.playTime.end=t.endTimestamp,this.playTime.now=this.playTime.start,this.play())}},clearInterval:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){this.$options.timeInterval&&(clearInterval(this.$options.timeInterval),this.$options.timeInterval=null)}))},destroyed:function(){this.stop()}},y=v,T=(n("dc0f"),n("2877")),g=Object(T["a"])(y,i,r,!1,null,"5a16763a",null);t["a"]=g.exports},dc0f:function(e,t,n){"use strict";n("e1fb")},e1fb:function(e,t,n){},e853:function(e,t,n){var i=n("d3f4"),r=n("1169"),a=n("2b4c")("species");e.exports=function(e){var t;return r(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!r(t.prototype)||(t=void 0),i(t)&&(t=t[a],null===t&&(t=void 0))),void 0===t?Array:t}}}]);